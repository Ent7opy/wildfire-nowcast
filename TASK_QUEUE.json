[
  {
    "id": "WN-FIRE-001",
    "title": "Reinterpret FIRMS confidence as weak prior",
    "type": "data-logic",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-006"],
    "worker_prompt": "Outcome: FIRMS confidence is no longer treated as wildfire probability.\n\nScope:\n- Inspect FIRMS confidence fields for MODIS and VIIRS.\n- Normalize confidence per sensor.\n- Treat confidence as a weak prior (max 20% weight).\n\nDo:\n- Document how confidence differs by sensor.\n- Implement normalization logic.\n\nDon't:\n- Use FIRMS confidence as a hard gate.\n\nAcceptance criteria:\n- Confidence alone cannot mark a detection as a real fire.\n\nRollback:\n- Revert confidence normalization logic."
  },
  {
    "id": "WN-FIRE-002",
    "title": "Implement persistence filtering",
    "type": "data-logic",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-006"],
    "worker_prompt": "Outcome: One-off thermal spikes are heavily penalized.\n\nScope:\n- Group detections spatially (<=750m).\n- Group temporally (last 24–72h).\n\nRules:\n- Require >=2 detections across time.\n- Bonus for multi-sensor confirmation.\n\nAcceptance criteria:\n- Single isolated detections are downgraded or hidden by default.\n\nRollback:\n- Disable persistence scoring and revert grouping logic."
  },
  {
    "id": "WN-FIRE-003",
    "title": "Add land-cover plausibility scoring",
    "type": "data-logic",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-006"],
    "worker_prompt": "Outcome: Fires are penalized in implausible land-cover types.\n\nScope:\n- Integrate land-cover dataset (coarse resolution acceptable).\n\nRules:\n- Penalize: urban, water, desert, bare land, ice.\n- Boost: forest, shrubland, savanna, grassland.\n\nAcceptance criteria:\n- Urban and desert regions no longer light up unrealistically.\n\nRollback:\n- Remove land-cover weighting from fire score."
  },
  {
    "id": "WN-FIRE-004",
    "title": "Integrate weather plausibility checks",
    "type": "data-logic",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-006"],
    "worker_prompt": "Outcome: Fire likelihood reflects meteorological plausibility.\n\nScope:\n- Use existing weather ingestion.\n\nRules:\n- Penalize if RH > ~70%.\n- Penalize after recent heavy precipitation (48–72h).\n- Boost for low RH and moderate/high wind.\n\nAcceptance criteria:\n- Wet regions show significantly fewer high-confidence fires.\n\nRollback:\n- Disable weather contribution to fire score."
  },
  {
    "id": "WN-FIRE-005",
    "title": "Add known false-source masking",
    "type": "data-logic",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-006"],
    "worker_prompt": "Outcome: Chronic non-fire heat sources are suppressed.\n\nScope:\n- Create or ingest static exclusion dataset.\n\nExamples:\n- Gas flares\n- Refineries\n- Power plants\n\nAcceptance criteria:\n- Same coordinates no longer appear as fires day after day.\n\nRollback:\n- Disable false-source mask."
  },
  {
    "id": "WN-FIRE-006",
    "title": "Compute composite Fire Likelihood Score",
    "type": "core-logic",
    "blocked_by": [
      "WN-FIRE-001",
      "WN-FIRE-002",
      "WN-FIRE-003",
      "WN-FIRE-004",
      "WN-FIRE-005"
    ],
    "unblocks": ["WN-FIRE-007"],
    "worker_prompt": "Outcome: Single Fire Likelihood Score (0–1) drives filtering.\n\nScope:\n- Combine all previous signals into composite score.\n\nSuggested weighting:\n- FIRMS confidence: <=20%\n- Persistence: ~30%\n- Land cover: ~20%\n- Weather: ~20%\n- Multi-sensor bonus: ~10%\n\nThresholds:\n- <0.3: hide by default\n- 0.3–0.6: uncertain\n- >0.6: likely real fire\n\nAcceptance criteria:\n- Global map looks plausible at default settings.\n- No continuous fire belts across Africa/India.\n\nRollback:\n- Revert to raw FIRMS filtering."
  },
  {
    "id": "WN-FIRE-007",
    "title": "Update UI to reflect fire likelihood semantics",
    "type": "ui",
    "blocked_by": ["WN-FIRE-006"],
    "unblocks": [],
    "worker_prompt": "Outcome: UI no longer misrepresents confidence.\n\nScope:\n- Rename slider from 'Minimum confidence' to 'Fire likelihood'.\n- Add tooltip explaining composite score.\n\nAcceptance criteria:\n- UI text matches backend semantics.\n- No implication that FIRMS confidence equals real fire.\n\nRollback:\n- Restore previous UI labels."
  },
  {
    "id": "WN-FIRE-008",
    "title": "Fix map tooltip template rendering for confidence",
    "type": "ui",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-010"],
    "worker_prompt": "Outcome: Map tooltip renders real values (no '{confidence}' placeholders).\n\nSymptoms:\n- Tooltip shows literal 'Confidence:{confidence}' instead of a number/value.\n\nLikely causes:\n- Tooltip string uses wrong interpolation method or wrong property key.\n- GeoJSON property name differs from expected (e.g. confidence vs conf vs firms_confidence).\n\nScope:\n- Trace data: backend/API -> map layer GeoJSON -> tooltip renderer.\n- Fix interpolation and/or property name mapping.\n\nAcceptance criteria:\n- Tooltip shows correct confidence for clicked point.\n- Tooltip does not show any '{...}' placeholders.\n\nRollback:\n- Revert tooltip rendering changes."
  },
  {
    "id": "WN-FIRE-009",
    "title": "Fix selected fire details panel data mapping",
    "type": "ui",
    "blocked_by": [],
    "unblocks": ["WN-FIRE-010"],
    "worker_prompt": "Outcome: Details panel shows correct fields for a clicked fire.\n\nSymptoms:\n- Details panel shows Timestamp/Satellite/Confidence/Source as None.\n- Selection says 'Fire detection' but lacks metadata.\n\nScope:\n- Identify the click handler / selection state object shape.\n- Ensure selected fire state includes at least:\n  - id\n  - timestamp (UTC)\n  - satellite/source\n  - confidence\n  - frp\n  - lat/lon (or geometry)\n- Fix mapping between GeoJSON properties and details UI fields.\n\nAcceptance criteria:\n- Clicking a point populates details panel with real values.\n- None values only appear when truly absent from source data.\n\nRollback:\n- Revert selection-state mapping changes."
  },
  {
    "id": "WN-FIRE-010",
    "title": "Fix forecast failure due to missing/incorrect coordinates in selected fire",
    "type": "core-logic",
    "blocked_by": ["WN-FIRE-009"],
    "unblocks": [],
    "worker_prompt": "Outcome: Forecast can be generated reliably from clicked fire points.\n\nSymptoms:\n- Forecast section says: 'Selected fire is missing coordinates. Cannot generate forecast.'\n\nLikely causes:\n- Selected fire state lacks lat/lon.\n- Coordinate keys swapped (lat/lon reversed) or wrong nesting (geometry vs properties).\n- Map click returns screen coords or cluster centroid instead of detection coords.\n\nScope:\n- Trace end-to-end: map click event -> selected fire state -> forecast request payload.\n- Ensure forecast request uses correct detection coordinates:\n  - If GeoJSON Point geometry exists: use geometry.coordinates [lon, lat].\n  - If only properties exist: use properties.longitude/latitude.\n- Add defensive validation:\n  - reject null/undefined\n  - validate ranges: lat [-90..90], lon [-180..180]\n- Add logging (dev-only) to print the payload when forecast generation fails.\n\nAcceptance criteria:\n- Clicking any non-cluster fire point enables forecast generation.\n- No 'missing coordinates' error for valid detections.\n- Coordinates sent to forecast are correct and within valid ranges.\n\nRollback:\n- Revert forecast payload construction changes."
  },
  {
    "id": "WN-FIRE-011",
    "title": "Add contract test for fire map feature properties used by UI",
    "type": "testing",
    "blocked_by": ["WN-FIRE-008", "WN-FIRE-009", "WN-FIRE-010"],
    "unblocks": [],
    "worker_prompt": "Outcome: Prevent future regressions where UI expects fields that map layer doesn't provide.\n\nScope:\n- Define a minimal 'FireMapFeature' contract (type/interface) listing required properties:\n  - id\n  - timestamp\n  - source/satellite\n  - confidence\n  - frp\n  - geometry (lon/lat)\n- Add a test (unit or integration) that validates:\n  - API/GeoJSON includes required keys\n  - UI mapping from feature -> selected fire produces required fields\n\nAcceptance criteria:\n- Test fails if confidence/timestamp/coords disappear or are renamed.\n\nRollback:\n- Remove the test file(s) if needed."
  }
]
